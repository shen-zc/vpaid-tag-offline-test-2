wwplayer.define(["jquery","underscore","AnimationController","pubsub","globals"],function(t,e,i,a,n){var o;return i.extend({init:function(t,i,l,s){o=this,this._super(t,i,l,s),o.comeInTimers=[],o.leaveTimers=[],o.frameRepresentedTagData={},o.tagsIn={},o.animatingTags=[],o.animatingStaticTags=[],o.staticPositions={},o.frameSubscriptionUnsubCallbacks=[],a.subscribe(n.HAS_SEEKED,function(){e.each(o.animatingStaticTags,function(t){t.hasBrungInStatic=!1}),o.animating||o.animFn(),e.each(o.animatingStaticTags,function(t){t.hasBrungInStatic=!1})}),a.subscribe(n.HAS_PLAYED,function(){o.animating||(o.animating=!0,window.requestAnimationFrame(o.animFn))}),n.HIDE_STATICS=!1},_refactorTagData:function(e,i,a,n){if(a.fixedElement){for(var o={},l={},s={},r=e.x.length,m=0;m<r;m++){var h=i+e.in+m-1;o[h]={left:Math.round(1e4*(e.x[m]-e.w[m]/2))/1e4,top:Math.round(1e4*(e.y[m]-e.h[m]/2))/1e4,height:parseFloat(e.h[m]),width:parseFloat(e.w[m])}}t.when(a.getFixedElementData()).then(function(t){for(var m=0;m<r;m++){var h=i+e.in+m-1;if(t.radius){var g=t.frequency,f=t.radius,d=t.direction;s[h]={left:parseFloat(t.left)+Math.cos(Math.PI*(d*m*g))*f,top:parseFloat(t.top)+Math.sin(Math.PI*(d*m*g))*f*(16/9)}}else s[h]=t;var c=o[h].top,p=o[h].left;t.corner&&(1===t.corner?(c=o[h].top-o[h].height/2,p=o[h].left-o[h].width/2):2===t.corner?(c=o[h].top-o[h].height/2,p=o[h].left+o[h].width/2):3===t.corner?(c=o[h].top+o[h].height/2,p=o[h].left+o[h].width/2):4===t.corner&&(c=o[h].top+o[h].height/2,p=o[h].left-o[h].width/2)),l[h]={width:Math.sqrt(Math.pow(16*(s[h].left-(p+o[h].width/2)),2)+Math.pow(9*(s[h].top-(c+o[h].height/2)),2))/16,left:s[h].left,top:s[h].top},l[h].rotate=Math.atan(9*(c+o[h].height/2-s[h].top)/(16*(p+o[h].width/2-s[h].left)))*(180/Math.PI),p+o[h].width/2<s[h].left&&(l[h].rotate+=180)}a.newTagData={movingElement:o,lineElement:l,fixedElement:s},a.movingElement.style.display="none",a.fixedElement.style.display="none",a.lineElement.style.display="none",n()})}else{for(var g={},r=e.x.length,m=0;m<r;m++){var h=i+e.in+m-1;g[h]={left:Math.round(1e4*(e.x[m]-e.w[m]/2))/1e4,top:Math.round(1e4*(e.y[m]-e.h[m]/2))/1e4,height:parseFloat(e.h[m]),width:parseFloat(e.w[m]),centerTop:parseFloat(e.y[m]),centerLeft:parseFloat(e.x[m])};var f=a.getKeyFrameCSS({top:g[h].top,left:g[h].left,width:g[h].width,height:g[h].height});for(var d in f)g[h][d]="auto"===f[d]?"auto":parseFloat(f[d])/100}a.newTagData=g,n()}},createAnimations:function(t,i,l,s){e.each(o.frameSubscriptionUnsubCallbacks,function(t){"function"==typeof t&&t()}),o.comeInTimers=[],o.leaveTimers=[],o.frameRepresentedTagData={},o.tagsIn={},o.animatingTags=[],o.staticPositions={},o.frameSubscriptionUnsubCallbacks=[];var r=0,m=0,h=function(){++m>=r&&(s?a.publish(n.HIDE_LOADER):o.animationsCreated())};e.each(t,function(t,a){e.each(t.tags,function(t,a){e.find(i,function(e){return e.spriteId===t.spriteId})&&r++})}),r>0?e.each(t,function(t,a){e.each(t.tags,function(a,n){var l=e.find(i,function(t){return t.spriteId===a.spriteId});l&&o._refactorTagData(a,t.in,l,h)})}):h();for(var g in l)if(i["-1-"+g]){var f=l[g],d="",c=0,p=parseFloat(f.w[0]),u=parseFloat(f.h[0]),w=parseFloat(f.y[0])-.5*u,T=parseFloat(f.x[0])-.5*p;if(i["-1-"+g].overridePosition())d+=c+"% {visibility: visible;}\r\n",c=100,d+=c+"% {visibility: visible;}\r\n",o.staticPositions["s"+g]={visibility:"visible"};else{var y={top:100*w+"%;",left:100*T+"%;",width:100*p+"%;",height:100*u+"%;",visibility:"visible"},v=i["-1-"+g].getKeyFrameCSS({top:w,left:T,width:p,height:u});for(var b in v)y[b]=v[b];o.staticPositions["s"+g]=y}o.animateStaticTag(i["-1-"+g])}},animateStaticTag:function(i){var a=this;i.element.style.display="none",t(i.element).css(a.staticPositions[i.tagIndex]),i.hasBrungInStatic=!1,e.contains(a.animatingStaticTags,i)||a.animatingStaticTags.push(i)},updateTailTagPosition:function(e,i,a,n){function o(t){return 100*t+"%"}var l=e.newTagData.movingElement[i],s=e.newTagData.movingElement[a],r=e.newTagData.lineElement[i],m=e.newTagData.lineElement[a],h=e.newTagData.fixedElement[i],g=e.newTagData.fixedElement[a];if(l&&s){var f={display:"block"},d={display:"block",left:o(h.left+(g.left-h.left)*n),top:o(h.top+(g.top-h.top)*n)},c={display:"block",left:o(r.left+(m.left-r.left)*n),top:o(r.top+(m.top-r.top)*n),width:o(r.width+(m.width-r.width)*n),"transform-origin":"0% 50%",transform:"rotate("+m.rotate+"deg)"},p={display:"block",left:o(l.left+(s.left-l.left)*n),top:o(l.top+(s.top-l.top)*n),width:o(l.width+(s.width-l.width)*n),height:o(l.height+(s.height-l.height)*n)},u={tagStyle:f,fixedElementStyle:d,lineElementStyle:c,movingElementStyle:p};e.onFrameUpdate&&(u=e.onFrameUpdate(u)||u),t(e.element).css(u.tagStyle),t(e.fixedElement).css(u.fixedElementStyle),t(e.lineElement).css(u.lineElementStyle),t(e.movingElement).css(u.movingElementStyle)}else e._hasBrungInTail=!1,e.movingElement.style.display="none",e.fixedElement.style.display="none",e.lineElement.style.display="none"},animFn:function(){var e=n.GET_CURRENT_PLAYING_TIME(),i=parseFloat(e*o.fps)+1,a=Math.floor(i),l=Math.ceil(i),s=i-a;o.animatingTags.forEach(function(e){var i,n,r,m,h,g;if(e.fixedElement)o.updateTailTagPosition(e,a,l,s);else{if(!e.newTagData)return void(e.element.style.display="none");if(h=e.newTagData[a],g=e.newTagData[l],h&&g){e.element.style.display="block",i="auto"===h.width?"auto":100*(h.width+(g.width-h.width)*s)+"%",n="auto"===h.height?"auto":100*(h.height+(g.height-h.height)*s)+"%",r="auto"===h.left?"auto":100*(h.left+(g.left-h.left)*s)+"%",m="auto"===h.top?"auto":100*(h.top+(g.top-h.top)*s)+"%";var f="auto"!==h.bottom&&h.bottom?100*(h.bottom+(g.bottom-h.bottom)*s)+"%":"auto",d="auto"!==h.right&&h.right?100*(h.right+(g.right-h.right)*s)+"%":"auto";e.element.style.width=i,e.element.style.height=n,e.element.style.left=r,e.element.style.top=m,e.element.style.bottom=f,e.element.style.right=d,h.left+h.width>.6?t(e.element).addClass("align-content-left"):t(e.element).removeClass("align-content-left"),e.onFrameUpdate&&e.onFrameUpdate({width:i,height:n,left:r,top:m,bottom:f,right:d})}else e.element.style.display="none"}}),o.animatingStaticTags.forEach(function(t){t.tagStartTime<=e&&t.tagAnimationTime+t.tagStartTime>=e?(t.element.style.display="block",t.element.style.visibility="visible",t.hasBrungInStatic||(t.hasBrungInStatic=!0,t.bringIn())):t.element.style.display="none"}),o.animating&&window.requestAnimationFrame(o.animFn)},animateTag:function(t,i,a,n){var o=this;if(0!==this.tagDisplayMode)if(n)a>0?(t._bringInTimeout&&window.clearTimeout(t._bringInTimeout),t._bringInTimeout=window.setTimeout(function(){t.bringIn(t),t._bringInTimeout=null},1e3*a)):t.bringIn(t),o.animating||(o.animating=!0,window.requestAnimationFrame(o.animFn)),t.isStatic||e.contains(o.animatingTags,t)||o.animatingTags.push(t);else{var l=1/o.fps;o.comeInTimers.push(window.setTimeout(function(){o.leaveTimers.push(window.setTimeout(function(){},i*l*1e3))},1e3*a))}t.isStatic&&!o.animating&&(o.animating=!0,window.requestAnimationFrame(o.animFn)),this._super(t,i,a)},pauseAnimation:function(t){this.animating=!1},animateTo:function(e,i,a,n,o,l){window.setTimeout(function(){t(e).animate(a,1e3*i,"linear",l)},1e3*n)},pauseTagAtPosition:function(t,e){window.requestAnimationFrame(function(){var e=parseFloat(n.GET_CURRENT_PLAYING_TIME()*o.fps)+1,i=Math.floor(e),a=Math.ceil(e),l=e-i;if(!t.newTagData&&!t.isStatic)return void(t.element.style.display="none");if(t.isStatic){o.animateStaticTag(t);var s=n.GET_CURRENT_PLAYING_TIME();t.tagStartTime<=s&&t.tagAnimationTime+t.tagStartTime>=s&&(t.element.style.display="block")}else if(t.fixedElement)o.updateTailTagPosition(t,i,a,l);else{if(!t.newTagData)return void(t.element.style.display="none");var r=t.newTagData[i],m=t.newTagData[a];if(r&&m){t.element.style.display="block";var h=r.width+(m.width-r.width)*l,g=r.height+(m.height-r.height)*l,f=r.left+(m.left-r.left)*l,d=r.top+(m.top-r.top)*l;t.element.style.width=100*h+"%",t.element.style.height=100*g+"%",t.element.style.left=100*f+"%",t.element.style.top=100*d+"%"}else t.element.style.display="none"}})}})});